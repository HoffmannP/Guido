function MemberArea(e,t){function r(e){return new Promise(function(r,o){try{r(sjcl.decrypt(e,n(t.split(":"))))}catch(e){o(e)}})}function n(e){return JSON.stringify({iv:e[0],v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes",salt:e[1],ct:e[2]})}function o(e){return function(t){return t.preventDefault(),e(),!1}}function i(){a(),r(c()).catch(L).then(s)}function a(){y.form.querySelectorAll(".error").forEach(function(e){e.classList.add("hidden")})}function c(){var e=y.form.querySelector('[name="password"]').value;return l("pwintern",e,30),e}function l(e,t,r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}function s(e){return u(e).then(d).then(f).then(h).catch(g)}function u(e){return y.dbx=new Dropbox({accessToken:e}),y.dbx.filesListFolder({path:""})}function d(e){if(e.has_more)throw"Too many entries";return e.entries.filter(function(e){return"file"===e[".tag"]})}function f(e){return y.form.classList.add("hidden"),y.memberArea=document.querySelector("div.member-area"),y.memberArea.classList.remove("hidden"),y.filelist=memberArea.querySelector("ul.filelist"),y.filelist.innerHTML="",y.memberArea.querySelector("button").addEventListener("click",m),e}function m(){y.form.classList.remove("hidden"),y.memberArea.classList.add("hidden"),l("pwintern","",-1)}function h(e){if(0===e.length)return y.filelist.innerHTML='<li><em class="blass">keine Dateien gefunden</em></li>',[];e.forEach(p)}function p(e){var t=document.createElement("li");t.innerHTML='<li><a href="'+e.path_lower+'" data-path="'+e.path_lower+'">'+e.name+" ("+b(e.size)+")</a></li>",t.addEventListener("click",v),y.filelist.appendChild(t)}function b(e){var t=Math.floor(Math.log(e)/Math.log(1024)),r=["B","KB","MB"][t],n=e/Math.pow(1024,t);return(n>=10?Math.round(n):Math.round(10*n)/10)+" "+r}function v(e){return!!e.target.dataset.blob||(e.preventDefault(),y.dbx.filesDownload({path:e.target.dataset.path}).then(w.bind(null,e.target)).catch(g),!1)}function w(e,t){e.href=window.URL.createObjectURL(t.fileBlob),e.download=t.name,e.dataset.blob=!0}function L(e){throw y.form.querySelector(".password.error").classList.remove("hidden"),y.form.querySelector('[name="password"]').value="",y.form.querySelector('[name="password"]').focus(),e}function g(e){console.error(e),y.form.querySelector(".error:not(.hidden)")||y.form.querySelector(".internal.error").classList.remove("hidden")}var y=this;y.form=document.querySelector(e),r(function(e){for(var t=e+"=",r=window.decodeURIComponent(document.cookie).split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}("pwintern")).then(s).catch(function(){y.form.classList.remove("hidden"),y.form.addEventListener("submit",o(i))})}
