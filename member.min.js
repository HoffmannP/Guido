function login(){var black=document.createElement("div");black.classList.add("black");document.body.addChild();var parameter=JSON.parse(document.querySelector('[name="token"]'));var token=sjcl.decrypt(document.querySelector('[name="password"]'),JSON.stringify({iv:parameter[0],v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes",salt:parameter[1],ct:parameter[2]}));queryFiles(token)}function queryFiles(token){var dbx=new Dropbox({accessToken:token});var filelist=document.querySelector("ul#filelist");dbx.filesListFolder({path:""}).then(handleFileList.bind(null,filelist,dbx)).catch(error)}function handleFileList(filelist,dbx,response){if(response.has_more){window.alert("Zu viele Eintr√§ge, bitte kontaktieren Sie den Administrator")}if(!response.entries.length){filelist.innerHTML("<li><em>keine Dateien gefunden</em></li>");return}response.entries.filter(function(entry){return entry[".tag"]==="file"}).forEach(listFile.bind(null,filelist));filelist.addEventListener("click",downloadFile.bind(null,dbx))}function error(error){console.error(error)}function listFile(ul,file){var li=document.createElement("li");li.innerHTML='<li><a href="'+file.path_lower+'">'+file.name+" ("+filesize(file.size)+")</a></li>";ul.appendChild(li)}function downloadFile(dbx,e){var href=e.target.getAttribute("href");if(href===null||href.substr(0,5)==="blob:"){return true}dbx.filesDownload({path:href}).then(handleDownload.bind(null,e.target)).catch(error);e.preventDefault();return false}function handleDownload(response,target){target.href=window.URL.createObjectURL(response.fileBlob);target.download=response.name;target.click()}function filesize(size){var exponent=Math.floor(Math.log(size)/Math.log(1024));var suffix=["B","KB","MB"][exponent];var unitSize=size/Math.pow(1024,exponent);var roundSize=unitSize>=10?Math.round(unitSize):Math.round(unitSize*10)/10;return roundSize+" "+suffix}document.body.addEventListener("click",".dbx_login",login);